---
title: Evaluación de vulnerabilidades de SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Aprenda a configurar la evaluación de vulnerabilidades de SQL y a interpretar los informes de evaluación en Azure SQL Database, Azure SQL Managed Instance y Azure Synapse Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 02/11/2021
tags: azure-synapse
ms.openlocfilehash: 1719c5a7112ee32f86d0593d274a59638cf81a0e
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/14/2021
ms.locfileid: "100376650"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>La evaluación de vulnerabilidades de SQL ayuda a identificar los puntos vulnerables de la base de datos
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

La evaluación de vulnerabilidades de SQL es un servicio fácil de configurar que puede detectar y corregir posibles puntos vulnerables en la base de datos, así como realizar un seguimiento de estos. Úsela para mejorar la seguridad de la base de datos de manera proactiva.

La evaluación de vulnerabilidades forma parte de la oferta [Azure Defender for SQL](azure-defender-for-sql.md), que es un paquete unificado de funcionalidades de seguridad avanzadas de SQL. Se puede acceder a la evaluación de vulnerabilidades y administrarla a través del portal central de Azure Defender for SQL.

> [!NOTE]
> Se admite la evaluación de vulnerabilidades para Azure SQL Database, Azure SQL Managed Instance y Azure Synapse Analytics. En lo que resta de artículo, se hace referencia a las bases de datos de Azure SQL Database, Azure SQL Managed Instance y Azure Synapse Analytics colectivamente como "bases de datos", y por servidor se entiende el [servidor](logical-servers.md) donde se hospedan las bases de datos de Azure SQL Database y Azure Synapse.

## <a name="what-is-sql-vulnerability-assessment"></a>¿Qué es la evaluación de vulnerabilidades de SQL?

La evaluación de vulnerabilidades de SQL es un servicio que proporciona visibilidad del estado de seguridad. La evaluación de vulnerabilidades incluye pasos procesables para resolver problemas de seguridad y mejorar la seguridad de la base de datos. Puede ayudarle a supervisar un entorno de base de datos dinámico en el que es difícil realizar un seguimiento de los cambios y mejorar su posición de seguridad de SQL.

La evaluación de vulnerabilidad es un servicio de detección integrado en Azure SQL Database. Este servicio emplea una base de conocimiento de reglas que marcan las vulnerabilidades de seguridad. Se resaltan las desviaciones de los procedimientos recomendados, como configuraciones inadecuadas, permisos excesivos y datos confidenciales desprotegidos.

Las reglas se basan en los procedimientos recomendados de Microsoft y se centran en los problemas de seguridad que presentan mayores riesgos para la base de datos y sus valiosos datos. Tratan los problemas de nivel de base de datos y los problemas de seguridad de nivel de servidor, como la configuración del firewall de servidor y los permisos de nivel de servidor.

Los resultados del examen incluyen pasos que requieren acción para corregir cada uno de los problemas y proporcionan scripts de solución personalizados donde sea aplicable. Para personalizar un informe de evaluación de su entorno, debe establecer una línea de base aceptable de lo siguiente:

- Configuraciones de permisos
- Configuraciones de características
- Configuración de base de datos

## <a name="configure-vulnerability-assessment"></a>Configuración de la evaluación de vulnerabilidades

Realice los siguientes pasos para configurar la evaluación de vulnerabilidades:

1. En [Azure Portal](https://portal.azure.com), abra el recurso específico de Azure SQL Database, SQL Managed Instance o Azure Synapse.

1. En el encabezado **Seguridad**, seleccione **Security Center**.

1. Seleccione **Configurar** en el vínculo para abrir el panel de configuración de Azure Defender para SQL para todo el servidor o la instancia administrada.

    :::image type="content" source="media/sql-vulnerability-assessment/opening-sql-configuration.png" alt-text="Apertura de la configuración de Azure Defender para SQL":::

    > [!NOTE]
    > La evaluación de vulnerabilidades de SQL requiere el plan **Azure Defender para SQL** para poder ejecutar exámenes. Para obtener más información sobre cómo habilitar Azure Defender para SQL, consulte [Azure Defender para SQL](azure-defender-for-sql.md).

1. En la página **Configuración del servidor**, defina la configuración de Azure Defender para SQL:

    :::image type="content" source="media/sql-vulnerability-assessment/sql-vulnerability-scan-settings.png" alt-text="Configuración de los exámenes de evaluación de vulnerabilidades de SQL":::

    1. Configure una cuenta de almacenamiento en la que se almacenarán los resultados del examen de todas las bases de datos del servidor o instancia administrada. Para más información sobre las cuentas de almacenamiento, vea [Acerca de las cuentas de almacenamiento de Azure](../../storage/common/storage-account-create.md).

        > [!TIP]
        > Para obtener más información sobre el almacenamiento de exámenes de evaluación de vulnerabilidades detrás de firewalls y redes virtuales, consulte [Almacenamiento de los resultados del examen de evaluación de vulnerabilidad en una cuenta de almacenamiento accesible detrás de firewalls y redes virtuales](sql-database-vulnerability-assessment-storage.md).

    1. Para configurar las evaluaciones de vulnerabilidades para que ejecuten exámenes semanales de forma automática para detectar configuraciones de seguridad incorrectas, establezca **Exámenes periódicos** en **Activado**. Los resultados se envían a las direcciones de correo electrónico que especifica en **Enviar informes de examen a**. También puede enviar por correo electrónico una notificación a los administradores y a los propietarios de la suscripción habilitando **Enviar también por correo electrónico una notificación a los administradores y a los propietarios de la suscripción**.

1. Los exámenes de evaluación de vulnerabilidades de SQL también se pueden ejecutar a petición:

    1. En la página **Security Center** del recurso, seleccione **View additional findings in Vulnerability Assessment** (Ver conclusiones adicionales de la evaluación de vulnerabilidades) para acceder a los resultados de exámenes anteriores.

        :::image type="content" source="media/sql-vulnerability-assessment/view-additional-findings-link.png" alt-text="Abrir los resultados del examen y las opciones de examen manual":::

    1. Para ejecutar un examen a petición para detectar vulnerabilidades en la base de datos, seleccione **Examinar** en la barra de herramientas:

        :::image type="content" source="media/sql-vulnerability-assessment/on-demand-vulnerability-scan.png" alt-text="Seleccione Examinar para ejecutar un examen de evaluación de vulnerabilidades a petición del recurso SQL":::


  > [!NOTE]
  > El examen es ligero y seguro. Tarda unos segundos en ejecutarse y es completamente de lectura. No realiza ningún cambio en la base de datos.

## <a name="remediate-vulnerabilities"></a>Corrección de vulnerabilidades

Cuando se completa un examen de vulnerabilidades, el informe se muestra en Azure Portal. El informe presenta lo siguiente:

- Una visión general del estado de seguridad
- El número de problemas encontrados
- Un resumen de los riesgos por gravedad
- Una lista de conclusiones para otras investigaciones

:::image type="content" source="media/sql-vulnerability-assessment/sample-sql-vulnerabilities-report.png" alt-text="Informe de examen de ejemplo del escáner de evaluación de vulnerabilidades de SQL":::

Para corregir las vulnerabilidades detectadas:

1. Revise los resultados y determine qué conclusiones del informe son verdaderos problemas de seguridad para su entorno.

1. Seleccione cada uno de los resultados erróneos para comprender su impacto y por qué se produjo un error en la comprobación de seguridad.

    > [!TIP]
    > En la página de detalles de las conclusiones se incluye información de corrección procesable que explica cómo resolver el problema.

    :::image type="content" source="media/sql-vulnerability-assessment/examining-vulnerability-findings.gif" alt-text="Examen de los resultados de un examen de vulnerabilidades":::

1. Cuando revise los resultados de la evaluación, puede marcar los resultados específicos como una *línea de base* aceptable en su entorno. La base de referencia es fundamentalmente una personalización de cómo se notifican los resultados. Los resultados que coinciden con la base de referencia se consideran efectuados en exámenes posteriores. Una vez establecido el estado de seguridad de la base de referencia, la evaluación de vulnerabilidades solo informa de las desviaciones con respecto a esa base de referencia. De esta manera, podrá centrar su atención en los problemas relevantes.

    :::image type="content" source="media/sql-vulnerability-assessment/baseline-approval.png" alt-text="Aprobación de una conclusión como base de referencia para futuros exámenes":::

1. Si cambia las bases de referencia, use el botón **Examinar** para ejecutar un examen a petición y ver el informe personalizado. Todas las conclusiones que haya agregado a la base de referencia ahora aparecerán en **Efectuado** con una indicación de que han realizado debido a los cambios de base de referencia.

    :::image type="content" source="media/sql-vulnerability-assessment/passed-per-custom-baseline.png" alt-text="Evaluaciones superadas que indican que se han efectuado por base de referencia personalizada":::

Los exámenes de evaluación de vulnerabilidades ahora pueden usarse para supervisar que la base de datos mantiene un alto nivel de seguridad y que se cumplen las directivas de la organización. 

## <a name="advanced-capabilities"></a>Capacidades avanzadas

### <a name="export-an-assessment-report"></a>Exportación de un informe de evaluación

Seleccione **Exportar resultados del examen** para crear un informe de Excel del resultado del examen que se pueda descargar. Este informe contiene una pestaña de resumen que muestra un resumen de la evaluación, incluidas todas las comprobaciones con errores. También incluye una pestaña **Resultados**, que refleja el conjunto completo de resultados del examen. Los resultados incluyen todas las comprobaciones que se han ejecutado y los detalles de resultado de cada una de ellas.

### <a name="view-scan-history"></a>Visualización del historial de exámenes

Seleccione **Historial de exámenes** en el panel Evaluación de vulnerabilidades para ver el historial de todos los exámenes ejecutados previamente en esta base de datos. Seleccione un examen concreto en la lista para ver los resultados detallados del examen.

## <a name="manage-vulnerability-assessments-programmatically"></a>Administración de las evaluaciones de vulnerabilidades mediante programación

### <a name="using-azure-powershell"></a>Uso de Azure PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> El módulo de Azure Resource Manager para PowerShell todavía es compatible, pero todo el desarrollo futuro se realizará para el módulo Az.Sql. Para estos cmdlets, consulte [AzureRM.Sql](/powershell/module/AzureRM.Sql/). Los argumentos para los comandos del módulo Az y los módulos AzureRm son esencialmente idénticos.

Puede usar los cmdlets de Azure PowerShell para administrar mediante programación sus evaluaciones de vulnerabilidad. Los cmdlets compatibles son:

| Nombre del cmdlet como vínculo | Descripción |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Borra la base de referencia de la regla de evaluación de vulnerabilidad.<br/>En primer lugar, establezca la línea de base antes de usar este cmdlet para eliminarla. |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Borra la configuración de evaluación de vulnerabilidades de una base de datos. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Borra la base de referencia de la regla de evaluación de vulnerabilidades de una base de datos administrada.<br/>En primer lugar, establezca la línea de base antes de usar este cmdlet para eliminarla. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Borra la configuración de la evaluación de vulnerabilidades de una base de datos administrada. |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Borra la configuración de la evaluación de vulnerabilidades de una instancia administrada. |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Convierte los resultados del examen de evaluación de vulnerabilidades de una base de datos en un archivo de Excel. |
| [Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Convierte los resultados del examen de evaluación de vulnerabilidades de una base de datos administrada en un archivo de Excel. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Obtiene la base de referencia de la regla de evaluación de vulnerabilidades de una base de datos para una regla determinada. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Obtiene la base de referencia de la regla de evaluación de vulnerabilidades de una base de datos administrada para una regla determinada. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Obtiene todos los registros de examen de evaluación de vulnerabilidades asociados con una base de datos dada. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Obtiene todos los registros de examen de evaluación de vulnerabilidades asociados con una base de datos administrada dada. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Devuelve la configuración de la evaluación de vulnerabilidades de una base de datos. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Devuelve la configuración de la evaluación de vulnerabilidad de una base de datos administrada. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Establece la base de referencia de la regla de evaluación de vulnerabilidad. |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Establece la base de referencia de la regla de evaluación de vulnerabilidades de una base de datos administrada. |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Desencadena el inicio de un examen de evaluación de vulnerabilidades en una base de datos. |
| [Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Desencadena el inicio de un examen de evaluación de vulnerabilidades en una base de datos administrada. |
| [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Actualiza la configuración de evaluación de vulnerabilidades de una base de datos. |
| [Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Actualiza la configuración de la evaluación de vulnerabilidades de una base de datos administrada. |
| [Update-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Actualiza la configuración de la evaluación de vulnerabilidades de una instancia administrada. |
| &nbsp; | &nbsp; |

Para obtener un ejemplo de script, consulte la página de [soporte técnico de PowerShell para la evaluación de vulnerabilidades de Azure SQL](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support).

### <a name="using-resource-manager-templates"></a>Uso de plantillas de Resource Manager

Para configurar las bases de referencia de evaluación de vulnerabilidades mediante plantillas de Azure Resource Manager, use el tipo `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines`.

Antes de agregar líneas base, asegúrese de haber habilitado `vulnerabilityAssessments`.

Este es un ejemplo para definir la regla de línea de base VA2065 en la base de datos `master` y VA1143 en la base de datos `user` como recursos en una plantilla de Resource Manager:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

En la base de datos `master` y la base de datos `user`, los nombres de los recursos se definen de forma diferente:

- Base de datos maestra: "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>master</b>')]",
- Base de datos de usuario: "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>default</b>')]",

Para controlar tipos de booleanos como true o false, establezca el resultado de la línea de base con entrada binaria como "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Pasos siguientes  

- Más información sobre [Azure Defender for SQL](azure-defender-for-sql.md).
- Más información sobre la [clasificación y detección de datos](data-discovery-and-classification-overview.md)
- Obtenga más información sobre el [Almacenamiento de los resultados del examen de evaluación de vulnerabilidad en una cuenta de almacenamiento accesible detrás de firewalls y redes virtuales](sql-database-vulnerability-assessment-storage.md).